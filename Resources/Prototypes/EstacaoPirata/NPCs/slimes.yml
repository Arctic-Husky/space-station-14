- type: htnCompound
  id: SlimeCompound
  branches:
  - tasks:
    - !type:HTNCompoundTask
      task: SlimeFoodCompound
  - tasks:
    - !type:HTNCompoundTask
      task: IdleCompound

- type: htnCompound
  id: SlimeFoodCompound
  branches:
  # Picks a nearby entity, moves into range, then eats it and waits the idle time.
  - tasks:
    - !type:HTNPrimitiveTask
      preconditions:
      - !type:HungryPrecondition
        minHungerState: Peckish  # See HungerThreshold enum
      operator: !type:UtilityOperator
        proto: NearbySlimeFood

    - !type:HTNPrimitiveTask
      preconditions:
      - !type:CoordinatesNotInRangePrecondition
        targetKey: TargetCoordinates
        rangeKey: MovementRangeClose
      - !type:TargetNotBadSlimeFoodPrecondition
        targetKey: Target
      operator: !type:MoveToOperator
#        shutdownState: PlanFinished
        pathfindInPlanning: true
        removeKeyOnFinish: false
        targetKey: TargetCoordinates
        pathfindKey: TargetPathfind
        rangeKey: MovementRangeClose
#      services:
#      - !type:UtilityService
#        id: OccupiedService
#        proto: NearbySlimeFood
#        key: Target

  - tasks:
    - !type:HTNPrimitiveTask
      preconditions:
      - !type:KeyExistsPrecondition
        key: Target
      - !type:TargetNotBadSlimeFoodPrecondition
        targetKey: Target
      operator: !type:SlimeConsumeOperator
        hungerThreshold: Okay

    - !type:HTNPrimitiveTask
      preconditions:
      - !type:KeyExistsPrecondition
        key: IdleTime
      operator: !type:WaitOperator
        key: IdleTime


#  # Picks a nearby food, moves into range, then eats it and waits the idle time.
#  - tasks:
#    - !type:HTNPrimitiveTask
#      preconditions:
#      - !type:HungryPrecondition
#        minHungerState: Peckish  # See HungerThreshold enum
#      operator: !type:UtilityOperator
#        proto: NearbyFood
#
#    - !type:HTNPrimitiveTask
#      operator: !type:MoveToOperator
#        pathfindInPlanning: true
#        removeKeyOnFinish: false
#        targetKey: TargetCoordinates
#        pathfindKey: TargetPathfind
#        rangeKey: MeleeRange
#
#    - !type:HTNPrimitiveTask
#      preconditions:
#      - !type:KeyExistsPrecondition
#        key: Target
#      operator: !type:AltInteractOperator
#
#    - !type:HTNPrimitiveTask
#      preconditions:
#      - !type:KeyExistsPrecondition
#        key: IdleTime
#      operator: !type:WaitOperator
#        key: IdleTime

# TODO: lidar com sistema de amizade
